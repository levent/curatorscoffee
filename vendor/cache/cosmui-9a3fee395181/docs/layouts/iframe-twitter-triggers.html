<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pachube to Twitter</title>
    <link rel="stylesheet" href="../../vendor/assets/stylesheets/compiled/twitter-triggers.css" />
    <style>
      #tweet, #previewtweet{
        width:744px;
        margin:0;
        min-height:60px;
        margin-top:2px;
      }
      
      #previewtweet{
        background:#EEE;
        padding:3px;
        color:gray;
      }
      
      p.tips{
        margin-top:2px;
        float:right;
      }
      
      a#twittertrigger-signout {
        display: block;
        text-align: right;
        margin-top: 10px;
        font-size: smaller;
        font-weight: normal;
      }
      
      p.tweet-counter {
        float: none;
      }
      
      .tweet-counter-warning {
        color: #D40D12 !important;
      }
    </style>
    
    <script type="text/javascript" src="https://d13nj05qmdn3m1.cloudfront.net/assets/external_triggers.js"></script>
    <script type="text/javascript">easyXDM.DomHelper.requiresJSON("https://d13nj05qmdn3m1.cloudfront.net/assets/json2.js");</script>
    <script>
var pbt = new PachubeTrigger();
    </script>
  </head>
  <body>
    <form action="" method="post" id="tweetform">
  <label for="tweet">Tweet text</label>
  <p class="tips">You can use {datastream}, {feed}, {value}, {time}, {feed_url} to have Pachube insert dynamic text</p>
  <textarea id="tweet" name="tweet">Datastream {datastream} of feed {feed} changed to {value} at {time} on #pachube at {feed_url}</textarea>
  <label>Tweet preview - @petecorreia</label>
  <p id="previewtweet">Datastream {datastream} of feed {feed} changed to {value} at {time} on #pachube at {feed_url}</p>
  <p class="tips tweet-counter">Approx <span id="tweet-counter">130</span> characters <span id="tweet-status">remaining</span>.</p>
  
  <p><a href="#" id="twittertrigger-signout">Sign out of Twitter (@petecorreia)</a></p>
  
</form>

<script src="/main.js"></script>
<script>
  pbt.addEventListener('save', function(cb){
    $.ajax({
      type: 'POST',
      url: '/triggers',
      data: $("#tweetform").serialize(),
      success: function(data){
        var url = window.location.href.split('?')[0].replace('/new', '/') + data.trigger_hash + '/send';
        pbt.saved(url);
      }
    });
  });

  pbt.ready();
</script>

  </body>  
</html>